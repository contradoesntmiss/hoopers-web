<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hoopers</title>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: #fff;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    h1 {
      text-align: center;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: none;
    }

    button {
      background: #fff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .card {
      background: #161616;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<h1>Hoopers</h1>

<!-- AUTH -->
<div id="auth">
  <h3>Sign Up</h3>
  <input id="signup-email" placeholder="Email" />
  <input id="signup-password" type="password" placeholder="Password" />
  <button id="signup-btn">Sign Up</button>

  <h3>Log In</h3>
  <input id="login-email" placeholder="Email" />
  <input id="login-password" type="password" placeholder="Password" />
  <button id="login-btn">Log In</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <h3>Upcoming Games</h3>
  <div id="games"></div>
  <button id="logout-btn">Log Out</button>
</div>

<script>
  // FORCE CONFIRM JS IS RUNNING
  console.log("JS LOADED");

  // -----------------------------
  // SUPABASE INIT
  // -----------------------------
  const SUPABASE_URL = "https://cxxvbnxhinetclfwrkbv.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4eHZibnhoaW5ldGNsZndya2J2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwMTcwNDAsImV4cCI6MjA4MjU5MzA0MH0.mcShjpKLY0DKR7eyQheHQnf0i_BsP-k6G6nKQpMKsoA";

  const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  // -----------------------------
  // BUTTONS (EXPLICIT LISTENERS)
  // -----------------------------
  document.getElementById("signup-btn").addEventListener("click", async () => {
    const email = document.getElementById("signup-email").value.trim();
    const password = document.getElementById("signup-password").value.trim();

    if (!email || !password) {
      alert("Enter email and password");
      return;
    }

    const { error } = await supabase.auth.signUp({ email, password });

    if (error) alert(error.message);
    else alert("Signup successful. You can log in.");
  });

  document.getElementById("login-btn").addEventListener("click", async () => {
    const email = document.getElementById("login-email").value.trim();
    const password = document.getElementById("login-password").value.trim();

    if (!email || !password) {
      alert("Enter email and password");
      return;
    }

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password
    });

    if (error) alert(error.message);
  });

  document.getElementById("logout-btn").addEventListener("click", async () => {
    await supabase.auth.signOut();
  });

  // -----------------------------
  // AUTH STATE
  // -----------------------------
  supabase.auth.onAuthStateChange((event, session) => {
    const auth = document.getElementById("auth");
    const app = document.getElementById("app");

    if (session) {
      auth.classList.add("hidden");
      app.classList.remove("hidden");
      loadGames();
    } else {
      auth.classList.remove("hidden");
      app.classList.add("hidden");
    }
  });

  // -----------------------------
  // LOAD GAMES
  // -----------------------------
  async function loadGames() {
    const { data, error } = await supabase
      .from("games")
      .select(`
        start_time,
        home_odds,
        away_odds,
        home_team:home_team_id ( name, primary_color ),
        away_team:away_team_id ( name, primary_color )
      `)
      .order("start_time");

    if (error) {
      console.error(error);
      return;
    }

    const container = document.getElementById("games");
    container.innerHTML = "";

    data.forEach(game => {
      const div = document.createElement("div");
      div.className = "card";

      div.innerHTML = `
        <div style="display:flex;gap:8px;align-items:center">
          <span style="width:18px;height:26px;background:${game.home_team.primary_color};border-radius:3px"></span>
          <strong>${game.home_team.name}</strong>
          vs
          <strong>${game.away_team.name}</strong>
          <span style="width:18px;height:26px;background:${game.away_team.primary_color};border-radius:3px"></span>
        </div>
        <div style="font-size:12px;color:#aaa;margin-top:6px">
          ${new Date(game.start_time).toLocaleString()}
        </div>
        <div style="margin-top:6px">
          Odds: ${game.home_odds} / ${game.away_odds}
        </div>
      `;

      container.appendChild(div);
    });
  }
</script>

</body>
</html>
